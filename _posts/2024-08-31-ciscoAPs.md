---
title: Going Full Circle with Cisco
date: 2024-08-30 23:00:00 -500
categories: [homelab, infrastructure, wifi, cisco]
tags: [homelab, wifi, cisco, infrastructure]     # TAG names should always be lowercase
---

# Starting over with Cisco APs

The honeymoon phase with Ubiquiti gear has come to an end. It's great stuff for some, but not me. 

The purpose of my homelab is this:

- Mimic *as closely as possible* real enterprise environments, just with an order of magnitude less users
- Maintain the same level of service availability and quality as a production enterprise environment
- Provide the highest level of flexibility as possible to allow testing different implementations/solutions quickly but accurately

I scored a box of Cisco 2702I APs from a cheap ebay listing a while back, now seems like a good time to use them to test with. Prices on 3802s are bargain basement, and 9115/9120s are on par with wifi6 unifi APs, if this goes well that's the next upgrade path.

## Switching n' stuff

Something that caught me early that I don't want to forget to mention: UBNT uses option 43 for its own purposes, so throwing the wlc ip there will hurt more than help. I had to specify my internal DNS servers (since I have the capwap A record pointing to the wlc), and set the domain name (suffix) AND disable option 43 in that DHCP scope to get it to work. Something I didn't encounter when using windows server or opn/pfsense.

For switching, I added an additional physical 10g link to the proxmox server to the cisco 3850 to add some bandwidth and to keep the prox config ez. The switch side is setup like this.

```ssh
interface TenGigabitEthernet1/1/1
 switchport trunk native vlan 20
 switchport trunk allowed vlan 1,2,10,15,20,30,40,50,60,99,100
 switchport mode trunk
```

The prox config is just a vlan aware vmbr on that additional port, nothing special.

APs *might* need special setup on the brocade, this is the cisco version of native vlan on a trunk.

```ssh
vlan 20 name wifi-mgmt by port
 tagged ethe 1/1/13 to 1/1/17

interface ethernet 1/1/13
 dual-mode  20
 inline power power-limit 30000
```

But I'll test this once things are a little more setup.

## The WLC

I'll be rolling out the Cisco 9809-CL cloud WLC for this. Maybe it's just my old edu creds, but i was able to download one of the popular recent versions without issue. Licensing is tied to each AP, and anything subscription based is obviously off the table, but we should be alright on the honor system.

Prox install is straight forward. Add the iso to whatever datastore you use, create a new vm and DO NOT START at the end of the wizard. I used these overkill settings:

- 8GB Ram
- 4 CPU cores
- Default everything else up to networking
- For networks, I setup 3 vmxnet NICs. 
1. net0 - OOB connection, connects to the mgmt network, not the wifi mgmt network
2. net1 - prod network, this gets AP mgmt and normal traffic (for now)
3. net2 - HA link, not using it now, but nice to have the option for a dedicated HA link to a secondary

I skipped the setup wizard because I've done this before but here are the commands I used:

```ssh
hostname skynet-wlc1
user-name admin privilege 15 password 0 [your-pw-here]
int gig 1
 no switchport
 ip address 192.168.15.2 255.255.255.0
 no shut
 exit
int gig 2
 switchport
 switchport mode trunk
 switchport trunk native vlan 20
 no shut
 exit
int vlan 77
 ip address 192.168.20.2 255.255.255.0
 no shut
 exit
ip route 192.168.15.0 255.255.255.0 192.168.15.1
ip route 0.0.0.0 0.0.0.0 192.168.20.1
wireless management interface vlan 20
ap dot11 5ghz shutdown 
ap dot11 24ghz shutdown 
ap country US
no ap dot11 5ghz shutdown
no ap dot11 24ghz shutdown
exit
ip name-server 192.168.1.5 192.168.1.6 192.168.1.7
ntp server pool.ntp.org
wireless config vwlc-ssc key-size 2048 signature-algo sha256 password 0 [your-pw-here]
```

That last command kicks off trustpoint and cert setup for the webui APs. 